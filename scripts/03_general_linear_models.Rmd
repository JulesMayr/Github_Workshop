---
title: "LMs"
author: "Julia Mayr"
date: "17/05/2024
output: html_document
---

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

**Assumptions:**

1. LINEAR REGRESSION:

To be able to assemble a y=mx+b formula, both y and x *must be continuous variables*. 

To use a linear regression, we have to meet the following assumptions: 
1.	The relationship between X and the mean of Y is linear
2.	The variance of the residual is the same for any value: we call this homoscedasticity
3.	The residuals are independent of each other - sampling one value does not make it more likely that you will sample another value 
4.	The residuals of the model are normally distributed 



2. ANOVA

An ANOVA is a statistical test that tells us if more than 2 groups are statistically significantly different from each other. The ANOVA is basically the same as a linear regression but our independent variable (our X) is a categorical (a factor to R) variable rather than a continuous. It also very similar to a t-test but it compares more than 2 groups. Importantly, ANOVA tells us the overall effect of a discrete variable but doesnâ€™t tell us about specific differences between groups. 

There are three main assumptions: 
1. The residuals are normally distributed 
2. The variance across groups is homogeneous (*Note* this is slightly different from the linear regression version)
3. The residuals are independent of each other. 



3. ANCOVA

To look at the influence of a categorical variable on the relationship between a continuous predictor variable and a continuous response variable. 

Basically have to assess our assumptions from both a linear regression and an ANOVA perspective. 

This means we have the following assumptions: 
1.The relationship between X and the mean of Y is linear
2.The residuals of the model are normally distributed 
3.The variance of the residual is the same for any group
4.The residuals are independent of each other - sampling one value does not make it more likely that you will sample another value 

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

```{r Setup, include=FALSE}

# include: whether to include anything from a code chunk in the output document --> when include = F, this whole chunk is excluded in the output!

knitr::opts_chunk$set(echo = TRUE)
# Sets the R markdown options so that the code is displayed in the final html file. If it is set to FALSE then the code isn't displayed only the result is 

rm(list=ls()) #clears my global environment

# Load libraries
library(vegan) # to calculate biodiversity measures
library(dplyr) # data manipulation
library(tidyr) # data manipulation
library(knitr) # data manipulation
library(ggplot2)  # plotting
library(viridis)  # pretty colours
source("../scripts/PlottingFunctions.R") # for the SE function and plotting 

options(stringsAsFactors = F)
#to make sure that all strings are treated as characters and not factors unless specified


```

```{r put the full dataset together}

#### data1 #######################################################################
# refers to simulation part 1 and 2

#load Beta1_all_scales
load("../data/processed/Beta1_all_scales.RData")

#rearrange
Beta1_all_scales <- Beta1_all_scales[,c(1,17,2:16)]

#give shorter name
full_data1 <- Beta1_all_scales

#calculate gamma diversity and add new column to full data 
gammadiv_calc <- full_data1[,c("avg_richness","Beta_div")]
full_data1$Gamma_div <- apply(gammadiv_calc, 1, prod)
    ## remember that gamma = alpha x beta --> when beta = 1, alpha div == gamma div
    ## this might be more interesting for beta-and-scale-manipulation dataset --> but it also gives us a continuous predictor variable for x

#only use data that I need
data1 <- full_data1[,c("Area","div","Intended_BetaDiv","Alpha_stab","Gamma_stab","Spatial_AS","avg_richness","Beta_div","Gamma_div")]


#take out div=12 and rename 
my_data <- data1[data1$div!=12,]

#save data in 01_data so that it is easier to reuse for more analyses - I save it in that folder to not confuse it with other intermediate outputs of the simulation
save(my_data, file = "../02_output_data/my_data.RData")

```

#Beta Simulation Graph

```{r Simulation Method Graph}

# using Area as a covariate 
# this graph shows really nicely how our simulation worked to create these continuous gradients of beta diversity just how we have it in the conceptual figure from the proposal

#### 1. Untransformed Data #############################################################################################################################################

my_data$div.factor <- as.factor(my_data$div)

lm.sim <- lm(Beta_div~Area*div.factor, data=my_data)
lm.sim
#jpeg(file="../graphs_1Dataset/my_data_lm.sim.diagnostic.jpeg")
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(lm.sim)  #plot the diagnostic plots --> this is not necessarily needed as this model was really only made to show that our method worked
                    #linearity: ok
                    #normality: double S shape
                    #homoscedasticity: strong increase in variance with increasing x
                    #outliers: ok
               
anova(lm.sim)      
summary(lm.sim)
confint(lm.sim)

#plot --> when using method="loess" r draws a smooth curve
#jpeg(file="../graphs_1Dataset/my_data_lm.sim.jpeg")
par(mfrow=c(1,1))
col.palette<-viridis(4) #change color palette 
plot.lm.sim<-ggplot(data=my_data, aes(y=Beta_div, x=Area))+
  geom_smooth(method="loess",  aes(col=div.factor))+ #makes sure that for every level, the line that is fit has a different color
  geom_point(aes(col=div.factor), #makes sure that the colors pertaining to a given factor are in the same color as the line that is fit 
             shape=20, #for a filled circle - 21 for open circles
             size=2,
             alpha=0.5)+ #for point transparency - between 0 and 1
  scale_fill_manual(values=col.palette, name="Alpha Diversity")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="Alpha Diversity")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Area")+
  ylab("Beta Diversity")+
  ggtitle("Beta Diversity ~ Area*Sown Alpha Diversity")+
  theme_bw()
plot.lm.sim


```

The statistical analysis consists of a series of models for each of the lower level and each of the higher level components within the diversity - stability framework. 

Breaking all the relationships up like this allows to test for the significance of area at each level of the framework. 

*NOTE*: Stability metrics should always be log-transformed - this is  because stability is multiplicative.

#M1

```{r M1 Alpha Stability ~ Alpha Diversity}

#### 1. Alpha Stability ~ Area #########################################################################################################################

#### log transform!

my_data$log.alpha <- log(my_data$Alpha_stab+1)
my_data$log.area <- log(my_data$Area+1)
my_data$log.area.factor <- as.factor(my_data$log.area)

M1.lm1 <- lm(log.alpha~log.area.factor, data=my_data)
M1.lm1
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M1.lm1)  #plot the diagnostic plots of lm1.anova for visual inspection of linearity, normality, homoscedasticity and outliers
anova(M1.lm1)      
summary(M1.lm1)
confint(M1.lm1)

#plot 
par(mfrow=c(1,1))
summary.M1.lm1<-summarySE(data=my_data, measurevar="log.alpha", groupvars="log.area.factor")
#change digits of ln(Area) to expressions based on the factor levels
summary.M1.lm1$logged.area <- summary.M1.lm1$log.area.factor #Makes a new variable that is the same as  log.area
levels(summary.M1.lm1$logged.area)<-c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels
col.palette<-viridis(8)
plot.M1.lm1<-ggplot(summary.M1.lm1, aes(x=logged.area, y=log.alpha,
                                                       ymax=log.alpha+se, 
                                                       ymin=log.alpha-se, 
                                                       group=logged.area, #this will make it possible for R to connect the points for you 
                                                       fill=logged.area))+
  geom_errorbar(width=0.3)+
  geom_point(shape=21, size=4)+
  scale_fill_manual(values=col.palette, name="Area")+
  scale_color_manual(values=col.palette, name="Area")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Area")+
  ylab("Alpha Stability (log)")+
  ggtitle("Alpha Stability ~ Area")+
  theme_bw()
plot.M1.lm1



#### 2. Alpha Stability ~ Alpha Diversity ##############################################################################################################

#### log transform!

my_data$log.alpha <- log(my_data$Alpha_stab+1)
my_data$log.div <- log(my_data$div+1)
my_data$log.div.factor <- as.factor(my_data$log.div)

M1.lm2 <- lm(log.alpha~log.div.factor, data=my_data)
M1.lm2
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M1.lm2)  #plot the diagnostic plots of lm2.anova for visual inspection of linearity, normality, homoscedasticity and outliers
anova(M1.lm2)      
summary(M1.lm2)
confint(M1.lm2)

#plot 
par(mfrow=c(1,1))
summary.M1.lm2<-summarySE(data=my_data, measurevar="log.alpha", groupvars="log.div.factor")
#change digits of ln(div) to expressions based on the factor levels
summary.M1.lm2$logged.div <- summary.M1.lm2$log.div.factor #Makes a new variable that is the same as  log.div
levels(summary.M1.lm2$logged.div)<-c("ln(1)","ln(4)","ln(8)") #renaming the levels
col.palette<-viridis(3)
plot.M1.lm2<-ggplot(summary.M1.lm2, aes(x=logged.div, y=log.alpha,
                                                       ymax=log.alpha+se, 
                                                       ymin=log.alpha-se, 
                                                       group=logged.div, #this will make it possible for R to connect the points for you 
                                                       fill=logged.div))+
  geom_errorbar(width=0.3)+
  geom_point(shape=21, size=4)+
  scale_fill_manual(values=col.palette, name="Alpha Diversity")+
  scale_color_manual(values=col.palette, name="Alpha Diversity")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Alpha diversity")+
  ylab("Alpha Stability (log)")+
  ggtitle("Alpha Stability ~ Alpha Diversity")+
  theme_bw()
plot.M1.lm2


#### 3. Alpha Stability ~ Area*Alpha Diversity #########################################################################################################

#### log transform!

my_data$log.alpha <- log(my_data$Alpha_stab+1)
my_data$log.area <- log(my_data$Area+1)
my_data$log.area.factor <- as.factor(my_data$log.area)
my_data$log.div <- log(my_data$div+1)
my_data$log.div.factor <- as.factor(my_data$log.div)

M1.lm3 <- lm(log.alpha~log.area.factor*log.div.factor, data=my_data)
M1.lm3
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M1.lm3)  #plot the diagnostic plots of lm31.anova for visual inspection of linearity, normality, homoscedasticity and outliers
anova(M1.lm3)      
summary(M1.lm3)
confint(M1.lm3)

#plot 
par(mfrow=c(1,1))
summary.M1.lm3<-summarySE(data=my_data, measurevar="log.alpha", groupvars=c("log.area.factor", "log.div.factor"))
#change digits to expressions based on the factor levels
summary.M1.lm3$logged.area <- summary.M1.lm3$log.area.factor #Makes a new variable that is the same as  log.area
levels(summary.M1.lm3$logged.area)<-c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels
summary.M1.lm3$logged.div <- summary.M1.lm3$log.div.factor #Makes a new variable that is the same as  log.div
levels(summary.M1.lm3$logged.div)<-c("1","4","8") #renaming the levels
col.palette<-viridis(8)
plot.M1.lm3<-ggplot(summary.M1.lm3, aes(x=logged.area, y=log.alpha,
                                                       ymax=log.alpha+se, 
                                                       ymin=log.alpha-se, 
                                                       group=logged.area, #this will make it possible for R to connect the points for you 
                                                       fill=logged.area))+
  geom_errorbar(width=0.3)+
  geom_point(shape=19, size=2, col="black")+
  scale_fill_manual(values=col.palette, name="Area")+
  scale_color_manual(values=col.palette, name="Area")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Area")+
  ylab("Alpha Stability (log)")+
  ylim(0.7,1.05)+
  ggtitle("Alpha Stability ~ Area*Alpha Diversity")+
  facet_grid(~logged.div)+
  scale_x_discrete(guide = guide_axis(n.dodge = 2))+
  theme_bw()+
  theme(axis.title = element_text(size=15, colour="black"), #to modify axes appearance
        axis.line.x = element_line(colour = "black"),
        axis.line.y = element_line(colour = "black"),
        axis.text.x = element_text(size=10,colour="black"),
        axis.text.y = element_text(size=10,colour="black"),
        axis.ticks = element_line(colour="black"),
        panel.border = element_rect(colour="black", fill=NA))
plot.M1.lm3

#### Compare models ####################################################################################################################################

anova(M1.lm1, M1.lm2, M1.lm3)
# M1.lm3 significantly improved the fit compared to the other ones

```

#M2

```{r M2 Gamma Stability ~ Alpha Diversity}

#### 1. Gamma Stability ~ Area #########################################################################################################################

#### log transform!

my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.area <- log(my_data$Area+1)
my_data$log.area.factor <- as.factor(my_data$log.area)

M2.lm1 <- lm(log.gamma~log.area.factor, data=my_data)
M2.lm1
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M2.lm1)  #plot the diagnostic plots of lm11.anova for visual inspection of linearity, normality, homoscedasticity and outliers
anova(M2.lm1)      
summary(M2.lm1)
confint(M2.lm1)

#plot 
par(mfrow=c(1,1))
summary.M2.lm1<-summarySE(data=my_data, measurevar="log.gamma", groupvars="log.area.factor")
#change digits of ln(Area) to expressions based on the factor levels
summary.M2.lm1$logged.area <- summary.M2.lm1$log.area.factor #Makes a new variable that is the same as  log.area
levels(summary.M2.lm1$logged.area)<-c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels
col.palette<-viridis(8)
plot.M2.lm1<-ggplot(summary.M2.lm1, aes(x=logged.area, y=log.gamma,
                                                       ymax=log.gamma+se, 
                                                       ymin=log.gamma-se, 
                                                       group=logged.area, #this will make it possible for R to connect the points for you 
                                                       fill=logged.area))+
  geom_errorbar(width=0.3)+
  geom_point(shape=21, size=4)+
  scale_fill_manual(values=col.palette, name="Area")+
  scale_color_manual(values=col.palette, name="Area")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Area")+
  ylab("Gamma Stability (log)")+
  ggtitle("Gamma Stability ~ Area")+
  theme_bw()
plot.M2.lm1



#### 2. Gamma Stability ~ Alpha Diversity ##############################################################################################################

#### log transform!

my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.div <- log(my_data$div+1)
my_data$log.div.factor <- as.factor(my_data$log.div)

M2.lm2 <- lm(log.gamma~log.div.factor, data=my_data)
M2.lm2
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M2.lm2)  #plot the diagnostic plots of lm2.anova for visual inspection of linearity, normality, homoscedasticity and outliers
anova(M2.lm2)      
summary(M2.lm2)
confint(M2.lm2)

#plot 
par(mfrow=c(1,1))
summary.M2.lm2<-summarySE(data=my_data, measurevar="log.gamma", groupvars="log.div.factor")
#change digits of ln(div) to expressions based on the factor levels
summary.M2.lm2$logged.div <- summary.M2.lm2$log.div.factor #Makes a new variable that is the same as  log.div
levels(summary.M2.lm2$logged.div)<-c("ln(1)","ln(4)","ln(8)") #renaming the levels
col.palette<-viridis(3)
plot.M2.lm2<-ggplot(summary.M2.lm2, aes(x=logged.div, y=log.gamma,
                                                       ymax=log.gamma+se, 
                                                       ymin=log.gamma-se, 
                                                       group=logged.div, #this will make it possible for R to connect the points for you 
                                                       fill=logged.div))+
  geom_errorbar(width=0.3)+
  geom_point(shape=21, size=4)+
  scale_fill_manual(values=col.palette, name="Alpha Diversity")+
  scale_color_manual(values=col.palette, name="Alpha Diversity")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Alpha diversity")+
  ylab("Gamma Stability (log)")+
  ggtitle("Gamma Stability ~ Alpha Diversity")+
  theme_bw()
plot.M2.lm2


#### 3. Gamma Stability ~ Area*Alpha Diversity #########################################################################################################

#### log transform!

my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.area <- log(my_data$Area+1)
my_data$log.area.factor <- as.factor(my_data$log.area)
my_data$log.div <- log(my_data$div+1)
my_data$log.div.factor <- as.factor(my_data$log.div)

M2.lm3 <- lm(log.gamma~log.area.factor*log.div.factor, data=my_data)
M2.lm3
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M2.lm3)  #plot the diagnostic plots of lm31.anova for visual inspection of linearity, normality, homoscedasticity and outliers
anova(M2.lm3)      
summary(M2.lm3)
confint(M2.lm3)

#plot 
par(mfrow=c(1,1))
summary.M2.lm3<-summarySE(data=my_data, measurevar="log.gamma", groupvars=c("log.area.factor", "log.div.factor"))
#change digits to expressions based on the factor levels
summary.M2.lm3$logged.area <- summary.M2.lm3$log.area.factor #Makes a new variable that is the same as  log.area
levels(summary.M2.lm3$logged.area)<-c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels
summary.M2.lm3$logged.div <- summary.M2.lm3$log.div.factor #Makes a new variable that is the same as  log.div
levels(summary.M2.lm3$logged.div)<-c("1","4","8") #renaming the levels
col.palette<-viridis(8)
plot.M2.lm3<-ggplot(summary.M2.lm3, aes(x=logged.area, y=log.gamma,
                                                       ymax=log.gamma+se, 
                                                       ymin=log.gamma-se, 
                                                       group=logged.area, #this will make it possible for R to connect the points for you 
                                                       fill=logged.area))+
  geom_errorbar(width=0.3)+
  geom_point(shape=19, size=2, col="black")+
  scale_fill_manual(values=col.palette, name="Area")+
  scale_color_manual(values=col.palette, name="Area")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Area")+
  ylab("Gamma Stability (log)")+
  ylim(0.7,1.05)+
  ggtitle("Gamma Stability ~ Area*Alpha Diversity")+
  facet_grid(~logged.div)+
  scale_x_discrete(guide = guide_axis(n.dodge = 2))+
  theme_bw()+
  theme(axis.title = element_text(size=15, colour="black"), #to modify axes appearance
        axis.line.x = element_line(colour = "black"),
        axis.line.y = element_line(colour = "black"),
        axis.text.x = element_text(size=10,colour="black"),
        axis.text.y = element_text(size=10,colour="black"),
        axis.ticks = element_line(colour="black"),
        panel.border = element_rect(colour="black", fill=NA))
plot.M2.lm3

#### Compare models ####################################################################################################################################

anova(M2.lm1, M2.lm2, M2.lm3)
# M2.lm3 significantly improved the fit compared to the other ones

```

#M3

```{r M3 Gamma Stability ~ Alpha Stability}

#### 1. Gamma Stability ~ Alpha Stability ##############################################################################################################

##### log transform!

my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.alpha <- log(my_data$Alpha_stab+1)

M3.lm1 <- lm(log.gamma~log.alpha, data=my_data)
M3.lm1
#jpeg(file="../graphs_1Dataset/my_data_M3.lm1.diagnostic.jpeg")
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M3.lm1) #plot the diagnostic plots of M3.lm1 for visual inspection of linearity, normality, homoscedasticity and outliers
                          
anova(M3.lm1)      
summary(M3.lm1)
confint(M3.lm1)

#plot the regression line
par(mfrow=c(1,1))
plot.M3.lm1 <- ggplot(my_data, aes(x=log.alpha,y=log.gamma))+
  geom_point()+
  geom_smooth(method="lm")+
  xlab("Alpha Stability (log)")+
  ylab("Gamma Stability (log)")+
  ggtitle("Temporal Stability ~ Alpha Stability")
plot.M3.lm1


#### 2. Gamma Stability ~ Alpha Stability*Area ########################################################################################################

#### Alpha Stability as a covariate
#### log transform!

my_data$log.alpha <- log(my_data$Alpha_stab+1)
my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.area <- log(my_data$Area+1)
my_data$log.area.factor <- as.factor(my_data$log.area)

M3.lm2 <- lm(log.gamma~log.alpha*log.area.factor, data=my_data)
M3.lm2
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M3.lm2)  #plot the diagnostic plots of lm10.anova for visual inspection of linearity, normality, homoscedasticity and outliers                 
anova(M3.lm2)      
summary(M3.lm2)
confint(M3.lm2)

#plot 
par(mfrow=c(1,1))
levels(my_data$log.area.factor) <- c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(8) #change color palette 
plot.M3.lm2<-ggplot(data=my_data, aes(y=log.gamma, x=log.alpha))+
  geom_smooth(method=lm,  aes(col=log.area.factor))+
  geom_point(shape=21, 
             size=1,
             alpha=0.75, 
             fill="black")+
  scale_fill_manual(values=col.palette, name="Area")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="Area")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Alpha Stability (log)")+
  ylab("Temporal Stability (log)")+
  ggtitle("Temporal Stability ~ Alpha Stability*Area")+
  theme_bw()
plot.M3.lm2



#### 3. Gamma Stability ~ Alpha Stability*Alpha Diversity ##############################################################################################

#### Alpha Stability as a covariate
#### log transform!

my_data$log.alpha <- log(my_data$Alpha_stab+1)
my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.div <- log(my_data$div+1)
my_data$log.div.factor <- as.factor(my_data$log.div)

M3.lm3 <- lm(log.gamma~log.alpha*log.div.factor, data=my_data)
M3.lm3
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M3.lm3)  #plot the diagnostic plots of lm10.anova for visual inspection of linearity, normality, homoscedasticity and outliers             
anova(M3.lm3)      
summary(M3.lm3)
confint(M3.lm3)

#plot 
par(mfrow=c(1,1))
levels(my_data$log.div.factor) <- c("ln(1)","ln(4)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(3) #change color palette 
plot.M3.lm3<-ggplot(data=my_data, aes(y=log.gamma, x=log.alpha))+
  geom_smooth(method=lm,  aes(col=log.div.factor))+
  geom_point(shape=21, 
             size=1,
             alpha=0.75, 
             fill="black")+
  scale_fill_manual(values=col.palette, name="Alpha Diversity")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="Alpha Diversity")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Alpha Stability (log)")+
  ylab("Temporal Stability (log)")+
  ggtitle("Temporal Stability ~ Alpha Stability*Alpha Diversity")+
  theme_bw()
plot.M3.lm3



#### 4. Gamma Stability ~ Alpha Stability*Area*Alpha Diversity #########################################################################################

#### log transform!

my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.alpha <- log(my_data$Alpha_stab+1)
my_data$log.div <- log(my_data$div+1)
my_data$log.div.factor <- as.factor(my_data$log.div)
my_data$log.area <- log(my_data$Area+1)
my_data$log.area.factor <- as.factor(my_data$log.area)

M3.lm4 <- lm(log.gamma~log.alpha*log.area.factor*log.div.factor, data=my_data)
M3.lm4
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M3.lm4)  #plot the diagnostic plots of M3.lm4 for visual inspection of linearity, normality, homoscedasticity and outliers                
anova(M3.lm4)      
summary(M3.lm4)
confint(M3.lm4)
        
#plot 
par(mfrow=c(1,1))
levels(my_data$log.area.factor) <- c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels of the categorical variable first
levels(my_data$log.div.factor) <- c("ln(1)","ln(4)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(8) #change color palette 
plot.M3.lm4<-ggplot(data=my_data, aes(y=log.gamma, x=log.alpha))+
  geom_smooth(method=lm,  aes(col=log.area.factor))+ #makes sure that for every level, the line that is fit has a different color
  geom_point(aes(col=log.area.factor), #makes sure that the colors pertaining to a given factor are in the same color as the line that is fit 
             shape=20, #for a filled circle - 21 for open circles
             size=2,
             alpha=0.5)+
  scale_fill_manual(values=col.palette, name="Area")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="Area")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Alpha Stability (log)")+
  ylab(" Gamma Diversity (log)")+
  ggtitle("Gamma Diversity ~ Alpha Stability*Area*Alpha Diversity")+
  facet_grid(~log.div.factor)+
  theme_bw()
plot.M3.lm4


#plot2
par(mfrow=c(1,1))
levels(my_data$log.area.factor) <- c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels of the categorical variable first
levels(my_data$log.div.factor) <- c("ln(1)","ln(4)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(3) #change color palette 
plot.M3.lm4<-ggplot(data=my_data, aes(y=log.gamma, x=log.alpha))+
  geom_smooth(method=lm,  aes(col=log.div.factor))+ #makes sure that for every level, the line that is fit has a different color
  geom_point(aes(col=log.div.factor), #makes sure that the colors pertaining to a given factor are in the same color as the line that is fit 
             shape=20, #for a filled circle - 21 for open circles
             size=2,
             alpha=0.5)+ #for point transparency - between 0 and 1
  scale_fill_manual(values=col.palette, name="Alpha Diversity")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="Alpha Diversity")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Alpha Stability (log)")+
  ylab(" Gamma Diversity (log)")+
  ggtitle("Gamma Diversity ~ Alpha Stability*Area*Alpha Diversity")+
  facet_grid(~log.area.factor)+
  theme_bw()
plot.M3.lm4

#### Compare models ####################################################################################################################################

anova(M3.lm1, M3.lm2, M3.lm3, M3.lm4)
# M3.lm2 and M3.lm4 seem equivalent but they both significantly improved the fit compared to the other ones

```

#M4

```{r M4 Spatial Asynchrony ~ Beta Diversity}

#### 1. Spatial Asynchrony ~ Beta Diversity ############################################################################################################

#### log transform!

my_data$log.SA <- log(my_data$Spatial_AS+1)
my_data$log.beta <- log(my_data$Beta_div+1)

M4.lm1 <- lm(log.SA~log.beta, data=my_data)
M4.lm1
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M4.lm1) #plot the diagnostic plots of M4.lm1 for visual inspection of linearity, normality, homoscedasticity and outliers
anova(M4.lm1)      
summary(M4.lm1)
confint(M4.lm1)

#plot the regression line
par(mfrow=c(1,1))
plot.M4.lm1 <- ggplot(my_data, aes(x=log.beta,y=log.SA))+
  geom_point()+
  geom_smooth(method="lm")+
  xlab("Beta Diversity (log)")+
  ylab("Spatial Asynchrony (log)")+
  ggtitle("Spatial Asynchrony ~ Beta Diversity")
plot.M4.lm1


#### 2. Spatial Asynchrony ~ Area ######################################################################################################################

#### log transform!

my_data$log.SA <- log(my_data$Spatial_AS+1)
my_data$log.area <- log(my_data$Area+1)
my_data$log.area.factor <- as.factor(my_data$log.area)

M4.lm2 <- lm(log.SA~log.area.factor, data=my_data)
M4.lm2
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M4.lm2)  #plot the diagnostic plots of lM41.anova for visual inspection of linearity, normality, homoscedasticity and outliers
               
anova(M4.lm2)      
summary(M4.lm2)
confint(M4.lm2)

#plot 
par(mfrow=c(1,1))
summary.M4.lm2<-summarySE(data=my_data, measurevar="log.SA", groupvars="log.area.factor")
#change digits of ln(Area) to expressions based on the factor levels
summary.M4.lm2$logged.area <- summary.M4.lm2$log.area.factor #Makes a new variable that is the same as  log.area
levels(summary.M4.lm2$logged.area)<-c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels
col.palette<-viridis(8)
plot.M4.lm2<-ggplot(summary.M4.lm2, aes(x=logged.area, y=log.SA,
                                                       ymax=log.SA+se, 
                                                       ymin=log.SA-se, 
                                                       group=logged.area, #this will make it possible for R to connect the points for you 
                                                       fill=logged.area))+
  geom_errorbar(width=0.3)+
  geom_line(aes(col=logged.area))+ #Add the lines color coded by functional group richness 
  geom_point(shape=21, size=2)+
  scale_fill_manual(values=col.palette, name="Area")+
  scale_color_manual(values=col.palette, name="Area")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Area")+
  ylab("Spatial Asynchrony (log)")+
  ggtitle("Spatial Asynchrony ~ Area")+
  theme_bw()+
  theme(axis.title = element_text(size=15, colour="black"), #to modify axes appearance
        axis.line.x = element_line(colour = "black"),
        axis.line.y = element_line(colour = "black"),
        axis.text.x = element_text(size=10,colour="black"),
        axis.text.y = element_text(size=10,colour="black"),
        axis.ticks = element_line(colour="black"),
        panel.border = element_rect(colour="black", fill=NA))
plot.M4.lm2


#### 3. Spatial Asynchrony ~ Area*Alpha Diversity ######################################################################################################

#### log transform!

my_data$log.SA <- log(my_data$Spatial_AS+1)
my_data$log.area <- log(my_data$Area+1)
my_data$log.area.factor <- as.factor(my_data$log.area)
my_data$log.div <- log(my_data$div+1)
my_data$log.div.factor <- as.factor(my_data$log.div)
my_data$div.factor <- as.factor(my_data$div)

M4.lm3 <- lm(log.SA~log.area.factor*log.div.factor, data=my_data)
M4.lm3
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M4.lm3)  #plot the diagnostic plots of lM41.anova for visual inspection of linearity, normality, homoscedasticity and outliers
               
anova(M4.lm3)      
summary(M4.lm3)
confint(M4.lm3)

#plot using facet_grid
par(mfrow=c(1,1))
summary.M4.lm3<-summarySE(data=my_data, measurevar="log.SA", groupvars=c("log.area.factor","log.div.factor"))
#change digits to expressions based on the factor levels
summary.M4.lm3$logged.area <- summary.M4.lm3$log.area.factor #Makes a new variable that is the same as  log.area
levels(summary.M4.lm3$logged.area)<-c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels
summary.M4.lm3$logged.div <- summary.M4.lm3$log.div.factor #Makes a new variable that is the same as  log.div
levels(summary.M4.lm3$logged.div)<-c("1","4","8") #renaming the levels
col.palette<-viridis(8)
plot.M4.lm3<-ggplot(summary.M4.lm3, aes(x=logged.area, y=log.SA,
                                                       ymax=log.SA+se, 
                                                       ymin=log.SA-se,
                                                       group=logged.area, #this will make it possible for R to connect the points for you 
                                                       fill=logged.area))+
  geom_errorbar(width=0.3)+
  geom_point(shape=19, size=2, col="black")+
  scale_fill_manual(values=col.palette, name="Area")+
  scale_color_manual(values=col.palette, name="Area")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Area")+
  ylab("Spatial Asynchrony (log)")+
  ylim(0,2.5)+
  ggtitle("Spatial Asynchrony ~ Area*Alpha Diversity")+
  facet_grid(~logged.div)+
  scale_x_discrete(guide = guide_axis(n.dodge = 2))+
  theme_bw()+
  theme(axis.title = element_text(size=15, colour="black"), #to modify axes appearance
        axis.line.x = element_line(colour = "black"),
        axis.line.y = element_line(colour = "black"),
        axis.text.x = element_text(size=10,colour="black"),
        axis.text.y = element_text(size=10,colour="black"),
        axis.ticks = element_line(colour="black"),
        panel.border = element_rect(colour="black", fill=NA))
plot.M4.lm3



#### 4. Spatial Asynchrony ~ Beta Diversity*Area #######################################################################################################

#### log transform!

my_data$log.SA <- log(my_data$Spatial_AS+1)
my_data$log.beta <- log(my_data$Beta_div+1)
my_data$log.area <- log(my_data$Area+1)
my_data$log.area.factor <- as.factor(my_data$log.area)

M4.lm4 <- lm(log.SA~log.beta*log.area.factor, data=my_data)
M4.lm4
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M4.lm4)  #plot the diagnostic plots of M4.lm4 for visual inspection of linearity, normality, homoscedasticity and outliers
anova(M4.lm4)      
summary(M4.lm4)
confint(M4.lm4)


#plot 
par(mfrow=c(1,1))
levels(my_data$log.area.factor) <- c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(8) #change color palette 
plot.M4.lm4<-ggplot(data=my_data, aes(y=log.SA, x=log.beta))+
  geom_smooth(method=lm,  aes(col=log.area.factor))+
  geom_point(shape=21, 
             size=1,
             alpha=0.75, 
             fill="black")+
  scale_fill_manual(values=col.palette, name="Area")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="Area")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Beta Diversity (log)")+
  ylab(" Spatial Asynchrony (log)")+
  ggtitle("Spatial Asynchrony ~ Beta Diversity*Area")+
  theme_bw()
plot.M4.lm4


#### 5. Spatial Asynchrony ~ Beta Diversity*Alpha Diversity ############################################################################################

#### log transform!

my_data$log.SA <- log(my_data$Spatial_AS+1)
my_data$log.beta <- log(my_data$Beta_div+1)
my_data$log.div <- log(my_data$div+1)
my_data$log.div.factor <- as.factor(my_data$log.div)

M4.lm5 <- lm(log.SA~log.beta*log.div.factor, data=my_data)
M4.lm5
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M4.lm5)  #plot the diagnostic plots of M4.lm5 for visual inspection of linearity, normality, homoscedasticity and outliers
anova(M4.lm5)      
summary(M4.lm5)
confint(M4.lm5)


#plot 
par(mfrow=c(1,1))
levels(my_data$log.div.factor) <- c("ln(1)","ln(4)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(3) #change color palette 
plot.M4.lm5<-ggplot(data=my_data, aes(y=log.SA, x=log.beta))+
  geom_smooth(method=lm,  aes(col=log.div.factor))+
  geom_point(shape=21, 
             size=1,
             alpha=0.75, 
             fill="black")+
  scale_fill_manual(values=col.palette, name="Alpha Diversity")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="Alpha Diversity")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Beta Diversity (log)")+
  ylab(" Spatial Asynchrony (log)")+
  ggtitle("Spatial Asynchrony ~ Beta Diversity*Alpha Diversity")+
  theme_bw()
plot.M4.lm5


#### 6. Spatial Asynchrony ~ Beta Diversity*Area*Alpha Diversity #######################################################################################

#### log transform!

my_data$log.SA <- log(my_data$Spatial_AS+1)
my_data$log.beta <- log(my_data$Beta_div+1)
my_data$log.div <- log(my_data$div+1)
my_data$log.div.factor <- as.factor(my_data$log.div)
my_data$log.area <- log(my_data$Area+1)
my_data$log.area.factor <- as.factor(my_data$log.area)

M4.lm6 <- lm(log.SA~log.beta*log.area.factor*log.div.factor, data=my_data)
M4.lm6
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M4.lm6)  #plot the diagnostic plots of M4.lm6 for visual inspection of linearity, normality, homoscedasticity and outliers 
anova(M4.lm6)      
summary(M4.lm6)
confint(M4.lm6)
        
#plot 
par(mfrow=c(1,1))
levels(my_data$log.area.factor) <- c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels of the categorical variable first
levels(my_data$log.div.factor) <- c("ln(1)","ln(4)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(8) #change color palette 
plot.M4.lm6<-ggplot(data=my_data, aes(y=log.SA, x=log.beta))+
  geom_smooth(method=lm,  aes(col=log.area.factor))+ #makes sure that for every level, the line that is fit has a different color
  geom_point(aes(col=log.area.factor), #makes sure that the colors pertaining to a given factor are in the same color as the line that is fit 
             shape=20, #for a filled circle - 21 for open circles
             size=2,
             alpha=0.5)+
  scale_fill_manual(values=col.palette, name="Area")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="Area")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Beta Diversity (log)")+
  ylab(" Spatial Asynchrony (log)")+
  ggtitle("Spatial Asynchrony ~ Beta Diversity*Area*Alpha Diversity")+
  facet_grid(~log.div.factor)+
  theme_bw()
plot.M4.lm6



#plot2
par(mfrow=c(1,1))
levels(my_data$log.area.factor) <- c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels of the categorical variable first
levels(my_data$log.div.factor) <- c("ln(1)","ln(4)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(3) #change color palette 
plot.M4.lm6<-ggplot(data=my_data, aes(y=log.SA, x=log.beta))+
  geom_smooth(method=lm,  aes(col=log.div.factor))+ #makes sure that for every level, the line that is fit has a different color
  geom_point(aes(col=log.div.factor), #makes sure that the colors pertaining to a given factor are in the same color as the line that is fit 
             shape=20, #for a filled circle - 21 for open circles
             size=2,
             alpha=0.5)+ #for point transparency - between 0 and 1
  scale_fill_manual(values=col.palette, name="Alpha Diversity")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="Alpha Diversity")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Beta Diversity (log)")+
  ylab(" Spatial Asynchrony (log)")+
  ggtitle("Spatial Asynchrony ~ Beta Diversity*Area*Alpha Diversity")+
  facet_grid(~log.area.factor)+
  theme_bw()
plot.M4.lm6

#### Compare models ####################################################################################################################################

anova(M4.lm1, M4.lm2, M4.lm3, M4.lm4, M4.lm5, M4.lm6)
# M4.lm3 and M4.lm4 and M4.lm6 seem equivalent but they both significantly improved the fit compared to the other ones


```

#M5

```{r M5 Gamma Stability ~ Beta Diversity}

#### 1. Gamma Stability ~ Beta Diversity ###############################################################################################################

##### log transform!

my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.beta <- log(my_data$Beta_div+1)

M5.lm1 <- lm(log.gamma~log.beta, data=my_data)
M5.lm1
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M5.lm1) #plot the diagnostic plots of M5.lm1 for visual inspection of linearity, normality, homoscedasticity and outliers
               
anova(M5.lm1)      
summary(M5.lm1)
confint(M5.lm1)

#plot the regression line
par(mfrow=c(1,1))
plot.M5.lm1 <- ggplot(my_data, aes(x=log.beta,y=log.gamma))+
  geom_point()+
  geom_smooth(method="lm")+
  xlab("Beta Diversity (log)")+
  ylab("Gamma Stability (log)")+
  ggtitle("Temporal Stability ~ Beta Diversity")
plot.M5.lm1


#### 2. Gamma Stability ~ Area #########################################################################################################################

#### log transform!

my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.area <- log(my_data$Area+1)
my_data$log.area.factor <- as.factor(my_data$log.area)

M5.lm2 <- lm(log.gamma~log.area.factor, data=my_data)
M5.lm2
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M5.lm2)  #plot the diagnostic plots of lm11.anova for visual inspection of linearity, normality, homoscedasticity and outliers
               
anova(M5.lm2)      
summary(M5.lm2)
confint(M5.lm2)

#plot 
par(mfrow=c(1,1))
summary.M5.lm2<-summarySE(data=my_data, measurevar="log.gamma", groupvars="log.area.factor")
#change digits of ln(Area) to expressions based on the factor levels
summary.M5.lm2$logged.area <- summary.M5.lm2$log.area.factor #Makes a new variable that is the same as  log.area
levels(summary.M5.lm2$logged.area)<-c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels
col.palette<-viridis(8)
plot.M5.lm2<-ggplot(summary.M5.lm2, aes(x=logged.area, y=log.gamma,
                                                       ymax=log.gamma+se, 
                                                       ymin=log.gamma-se, 
                                                       group=logged.area, #this will make it possible for R to connect the points for you 
                                                       fill=logged.area))+
  geom_errorbar(width=0.3)+
  geom_line(aes(col=logged.area))+ #Add the lines color coded by functional group richness 
  geom_point(shape=21, size=4)+
  scale_fill_manual(values=col.palette, name="Area")+
  scale_color_manual(values=col.palette, name="Area")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Area")+
  ylab("Gamma Stability (log)")+
  ggtitle("Gamma Stability ~ Area")+
  theme_bw()
plot.M5.lm2


#### 3. Gamma Stability ~ Area*Alpha Diversity #########################################################################################################

#### log transform!

my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.area <- log(my_data$Area+1)
my_data$log.area.factor <- as.factor(my_data$log.area)
my_data$log.div <- log(my_data$div+1)
my_data$log.div.factor <- as.factor(my_data$log.div)

M5.lm3 <- lm(log.gamma~log.area.factor*log.div.factor, data=my_data)
M5.lm3
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M5.lm3)  #plot the diagnostic plots of lm11.anova for visual inspection of linearity, normality, homoscedasticity and outliers 
               
anova(M5.lm3)      
summary(M5.lm3)
confint(M5.lm3)

#plot using facet_grid
par(mfrow=c(1,1))
summary.M5.lm3<-summarySE(data=my_data, measurevar="log.gamma", groupvars=c("log.area.factor","log.div.factor"))
#change digits to expressions based on the factor levels
summary.M5.lm3$logged.area <- summary.M5.lm3$log.area.factor #Makes a new variable that is the same as  log.area
levels(summary.M5.lm3$logged.area)<-c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels
summary.M5.lm3$logged.div <- summary.M5.lm3$log.div.factor #Makes a new variable that is the same as  log.div
levels(summary.M5.lm3$logged.div)<-c("1","4","8") #renaming the levels
col.palette<-viridis(8)
plot.M5.lm3<-ggplot(summary.M5.lm3, aes(x=logged.area, y=log.gamma,
                                                       ymax=log.gamma+se, 
                                                       ymin=log.gamma-se, 
                                                       group=logged.area, #this will make it possible for R to connect the points for you 
                                                       fill=logged.area))+
  geom_errorbar(width=0.3)+
  geom_point(shape=19, size=2, col="black")+
  scale_fill_manual(values=col.palette, name="Area")+
  scale_color_manual(values=col.palette, name="Area")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Area")+
  ylab("Gamma Stability (log)")+
  ylim(0.75,1.05)+
  ggtitle("Gamma Stability ~ Area*Alpha Diversity")+
  facet_grid(~logged.div)+
  scale_x_discrete(guide = guide_axis(n.dodge = 2))+
  theme_bw()+
  theme(axis.title = element_text(size=15, colour="black"), #to modify axes appearance
        axis.line.x = element_line(colour = "black"),
        axis.line.y = element_line(colour = "black"),
        axis.text.x = element_text(size=10,colour="black"),
        axis.text.y = element_text(size=10,colour="black"),
        axis.ticks = element_line(colour="black"),
        panel.border = element_rect(colour="black", fill=NA))
plot.M5.lm3

#### 4. Gamma Stability ~ Beta Diversity*Area ##########################################################################################################

#### log transform!

my_data$log.beta <- log(my_data$Beta_div+1)
my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.area <- log(my_data$Area+1)
my_data$log.area.factor <- as.factor(my_data$log.area)

M5.lm4 <- lm(log.gamma~log.beta*log.area.factor, data=my_data)
M5.lm4
#jpeg(file="../graphs_1Dataset/my_data_M5.lm4.diagnostic.jpeg")
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M5.lm4)  #plot the diagnostic plots of lm11.anova for visual inspection of linearity, normality, homoscedasticity and outliers
               
anova(M5.lm4)      
summary(M5.lm4)
confint(M5.lm4)

#plot 
par(mfrow=c(1,1))
levels(my_data$log.area.factor) <- c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(8) #change color palette 
plot.M5.lm4<-ggplot(data=my_data, aes(y=log.gamma, x=log.beta))+
  geom_smooth(method=lm,  aes(col=log.area.factor))+
  geom_point(shape=21, 
             size=1,
             alpha=0.75, 
             fill="black")+
  scale_fill_manual(values=col.palette, name="Area")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="Area")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Beta Diversity (log)")+
  ylab("Temporal Stability (log)")+
  ggtitle("Temporal Stability ~ Beta Diversity*Area")+
  theme_bw()
plot.M5.lm4


#### 5. Gamma Stability ~ Beta Diversity*Alpha Diversity ###############################################################################################

#### log transform!

my_data$log.beta <- log(my_data$Beta_div+1)
my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.div <- log(my_data$div+1)
my_data$log.div.factor <- as.factor(my_data$log.div)

M5.lm5 <- lm(log.gamma~log.beta*log.div.factor, data=my_data)
M5.lm5
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M5.lm5)  #plot the diagnostic plots of lm11.anova for visual inspection of linearity, normality, homoscedasticity and outliers
               
anova(M5.lm5)      
summary(M5.lm5)
confint(M5.lm5)

#plot 
par(mfrow=c(1,1))
levels(my_data$log.div.factor) <- c("ln(1)","ln(4)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(8) #change color palette 
plot.M5.lm5<-ggplot(data=my_data, aes(y=log.gamma, x=log.beta))+
  geom_smooth(method=lm,  aes(col=log.div.factor))+
  geom_point(shape=21, 
             size=1,
             alpha=0.75, 
             fill="black")+
  scale_fill_manual(values=col.palette, name="div")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="div")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Beta Diversity (log)")+
  ylab("Temporal Stability (log)")+
  ggtitle("Temporal Stability ~ Beta Diversity*div")+
  theme_bw()
plot.M5.lm5


#### 6. Spatial Asynchrony ~ Beta Diversity*Area*Alpha Diversity #######################################################################################

#### log transform!

my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.beta <- log(my_data$Beta_div+1)
my_data$log.div <- log(my_data$div+1)
my_data$log.div.factor <- as.factor(my_data$log.div)
my_data$log.area <- log(my_data$Area+1)
my_data$log.area.factor <- as.factor(my_data$log.area)

M5.lm6 <- lm(log.gamma~log.beta*log.area.factor*log.div.factor, data=my_data)
M5.lm6
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M5.lm6)  #plot the diagnostic plots of M5.lm6 for visual inspection of linearity, normality, homoscedasticity and outliers
anova(M5.lm6)      
summary(M5.lm6)
confint(M5.lm6)
        
#plot 
par(mfrow=c(1,1))
levels(my_data$log.area.factor) <- c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels of the categorical variable first
levels(my_data$log.div.factor) <- c("ln(1)","ln(4)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(8) #change color palette 
plot.M5.lm6<-ggplot(data=my_data, aes(y=log.gamma, x=log.beta))+
  geom_smooth(method=lm,  aes(col=log.area.factor))+ #makes sure that for every level, the line that is fit has a different color
  geom_point(aes(col=log.area.factor), #makes sure that the colors pertaining to a given factor are in the same color as the line that is fit 
             shape=20, #for a filled circle - 21 for open circles
             size=2,
             alpha=0.5)+
  scale_fill_manual(values=col.palette, name="Area")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="Area")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Beta Diversity (log)")+
  ylab(" Gamma Diversity (log)")+
  ggtitle("Gamma Diversity ~ Beta Diversity*Area*Alpha Diversity")+
  facet_grid(~log.div.factor)+
  theme_bw()
plot.M5.lm6



#plot2
par(mfrow=c(1,1))
levels(my_data$log.area.factor) <- c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels of the categorical variable first
levels(my_data$log.div.factor) <- c("ln(1)","ln(4)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(3) #change color palette 
plot.M5.lm6<-ggplot(data=my_data, aes(y=log.gamma, x=log.beta))+
  geom_smooth(method=lm,  aes(col=log.div.factor))+ #makes sure that for every level, the line that is fit has a different color
  geom_point(aes(col=log.div.factor), #makes sure that the colors pertaining to a given factor are in the same color as the line that is fit 
             shape=20, #for a filled circle - 21 for open circles
             size=2,
             alpha=0.5)+ #for point transparency - between 0 and 1
  scale_fill_manual(values=col.palette, name="Alpha Diversity")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="Alpha Diversity")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Beta Diversity (log)")+
  ylab(" Gamma Diversity (log)")+
  ggtitle("Gamma Diversity ~ Beta Diversity*Area*Alpha Diversity")+
  facet_grid(~log.area.factor)+
  theme_bw()
plot.M5.lm6

#### Compare models ####################################################################################################################################

anova(M5.lm1, M5.lm2, M5.lm3, M5.lm4, M5.lm5, M5.lm6)
# M5.lm3 and M5.lm4 seem equivalent but they both significantly improved the fit compared to the other ones

```

#M6

```{r M6 Gamma Stability ~ Spatial Asynchrony}

#### 1. Gamma Stability ~ Spatial Asynchrony ###########################################################################################################

##### log transform!

my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.SA <- log(my_data$Spatial_AS+1)

M6.lm1 <- lm(log.gamma~log.SA, data=my_data)
M6.lm1
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M6.lm1) #plot the diagnostic plots of M6.lm1 for visual inspection of linearity, normality, homoscedasticity and outliers
               
anova(M6.lm1)      
summary(M6.lm1)
confint(M6.lm1)

#plot the regression line
par(mfrow=c(1,1))
plot.M6.lm1 <- ggplot(my_data, aes(x=log.SA,y=log.gamma))+
  geom_point()+
  geom_smooth(method="lm")+
  xlab("Spatial Asynchrony (log)")+
  ylab("Gamma Stability (log)")+
  ggtitle("Temporal Stability ~ Spatial Asynchrony")
plot.M6.lm1


#### 2. Gamma Stability ~ Spatial Asynchrony*Area ######################################################################################################

#### log transform!

my_data$log.SA <- log(my_data$Spatial_AS+1)
my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.area <- log(my_data$Area+1)
my_data$log.area.factor <- as.factor(my_data$log.area)

M6.lm2 <- lm(log.gamma~log.SA*log.area.factor, data=my_data)
M6.lm2
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M6.lm2)  #plot the diagnostic plots of lm10.anova for visual inspection of linearity, normality, homoscedasticity and outliers
               
anova(M6.lm2)      
summary(M6.lm2)
confint(M6.lm2)

#plot 
par(mfrow=c(1,1))
levels(my_data$log.area.factor) <- c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(8) #change color palette 
plot.M6.lm2<-ggplot(data=my_data, aes(y=log.gamma, x=log.SA))+
  geom_smooth(method=lm,  aes(col=log.area.factor))+
  geom_point(aes(col=log.area.factor), #makes sure that the colors pertaining to a given factor are in the same color as the line that is fit 
             shape=20, #for a filled circle - 21 for open circles
             size=2,
             alpha=0.5)+
  scale_fill_manual(values=col.palette, name="Area")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="Area")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Spatial Asynchrony (log)")+
  ylab("Temporal Stability (log)")+
  ggtitle("Temporal Stability ~ Spatial Asynchrony*Area")+
  theme_bw()
plot.M6.lm2

#### 3. Gamma Stability ~ Spatial Asynchrony*Alpha Diversity ###########################################################################################

#### log transform!

my_data$log.SA <- log(my_data$Spatial_AS+1)
my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.div <- log(my_data$div+1)
my_data$log.div.factor <- as.factor(my_data$log.div)

M6.lm3 <- lm(log.gamma~log.SA*log.div.factor, data=my_data)
M6.lm3
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M6.lm3)  #plot the diagnostic plots of lm10.anova for visual inspection of linearity, normality, homoscedasticity and outliers               
anova(M6.lm3)      
summary(M6.lm3)
confint(M6.lm3)

#plot 
par(mfrow=c(1,1))
levels(my_data$log.div.factor) <- c("ln(1)","ln(4)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(3) #change color palette 
plot.M6.lm3<-ggplot(data=my_data, aes(y=log.gamma, x=log.SA))+
  geom_smooth(method=lm,  aes(col=log.div.factor))+
  geom_point(shape=21, 
             size=1,
             alpha=0.75, 
             fill="black")+
  scale_fill_manual(values=col.palette, name="div")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="div")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Spatial Asynchrony (log)")+
  ylab("Temporal Stability (log)")+
  ggtitle("Temporal Stability ~ Spatial Asynchrony*Alpha Diversity")+
  theme_bw()
plot.M6.lm3



#### 4. Gamma Stability ~ Spatial Asynchrony*Area*Alpha Diversity ######################################################################################

#### log transform!

my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.SA <- log(my_data$Spatial_AS+1)
my_data$log.div <- log(my_data$div+1)
my_data$log.div.factor <- as.factor(my_data$log.div)
my_data$log.area <- log(my_data$Area+1)
my_data$log.area.factor <- as.factor(my_data$log.area)

M6.lm4 <- lm(log.gamma~log.SA*log.area.factor*log.div.factor, data=my_data)
M6.lm4
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M6.lm4)  #plot the diagnostic plots of M6.lm4 for visual inspection of linearity, normality, homoscedasticity and outliers
anova(M6.lm4)      
summary(M6.lm4)
confint(M6.lm4)
        
#plot 
par(mfrow=c(1,1))
levels(my_data$log.area.factor) <- c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels of the categorical variable first
levels(my_data$log.div.factor) <- c("ln(1)","ln(4)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(8) #change color palette 
plot.M6.lm4<-ggplot(data=my_data, aes(y=log.gamma, x=log.SA))+
  geom_smooth(method=lm,  aes(col=log.area.factor))+ #makes sure that for every level, the line that is fit has a different color
  geom_point(aes(col=log.area.factor), #makes sure that the colors pertaining to a given factor are in the same color as the line that is fit 
             shape=20, #for a filled circle - 21 for open circles
             size=2,
             alpha=0.5)+
  scale_fill_manual(values=col.palette, name="Area")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="Area")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Spatial Asynchrony (log)")+
  ylab(" Gamma Diversity (log)")+
  ggtitle("Gamma Diversity ~ Spatial Asynchrony*Area*Alpha Diversity")+
  facet_grid(~log.div.factor)+
  theme_bw()
plot.M6.lm4



#plot2
par(mfrow=c(1,1))
levels(my_data$log.area.factor) <- c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels of the categorical variable first
levels(my_data$log.div.factor) <- c("ln(1)","ln(4)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(3) #change color palette 
plot.M6.lm4<-ggplot(data=my_data, aes(y=log.gamma, x=log.SA))+
  geom_smooth(method=lm,  aes(col=log.div.factor))+ #makes sure that for every level, the line that is fit has a different color
  geom_point(aes(col=log.div.factor), #makes sure that the colors pertaining to a given factor are in the same color as the line that is fit 
             shape=20, #for a filled circle - 21 for open circles
             size=2,
             alpha=0.5)+ #for point transparency - between 0 and 1
  scale_fill_manual(values=col.palette, name="Alpha Diversity")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="Alpha Diversity")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Spatial Asynchrony (log)")+
  ylab(" Gamma Diversity (log)")+
  ggtitle("Gamma Diversity ~ Spatial Asynchrony*Area*Alpha Diversity")+
  facet_grid(~log.area.factor)+
  theme_bw()
plot.M6.lm4

#### Compare models ####################################################################################################################################

anova(M6.lm1, M6.lm2, M6.lm3, M6.lm4)
# M6.lm2 and M6.lm4 seem equivalent but they both significantly improved the fit compared to the other ones

```

#M7

```{r M7 Gamma Stability ~ Gamma Diversity}

#### 1. Gamma Stability ~ Gamma Diversity ##############################################################################################################

##### log transform!

my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.gammadiv <- log(my_data$Gamma_div+1)

M7.lm1 <- lm(log.gamma~log.gammadiv, data=my_data)
M7.lm1
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M7.lm1) #plot the diagnostic plots of M7.lm1 for visual inspection of linearity, normality, homoscedasticity and outliers
               
anova(M7.lm1)      
summary(M7.lm1)
confint(M7.lm1)

#plot the regression line
par(mfrow=c(1,1))
plot.M7.lm1 <- ggplot(my_data, aes(x=log.gammadiv,y=log.gamma))+
  geom_point()+
  geom_smooth(method="lm")+
  xlab("Gamma Diversity (log)")+
  ylab("Gamma Stability (log)")+
  ggtitle("Temporal Stability ~ Gamma Diversity")
plot.M7.lm1


#### 2. Gamma Stability ~ Gamma Diversity*Area #########################################################################################################

#### log transform!

my_data$log.gammadiv <- log(my_data$Gamma_div+1)
my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.area <- log(my_data$Area+1)
my_data$log.area.factor <- as.factor(my_data$log.area)

M7.lm2 <- lm(log.gamma~log.gammadiv*log.area.factor, data=my_data)
M7.lm2
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M7.lm2)  #plot the diagnostic plots of lm10.anova for visual inspection of linearity, normality, homoscedasticity and outliers
               
anova(M7.lm2)      
summary(M7.lm2)
confint(M7.lm2)

#plot 
par(mfrow=c(1,1))
levels(my_data$log.area.factor) <- c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(8) #change color palette 
plot.M7.lm2<-ggplot(data=my_data, aes(y=log.gamma, x=log.gammadiv))+
  geom_smooth(method=lm,  aes(col=log.area.factor))+
  geom_point(aes(col=log.area.factor), #makes sure that the colors pertaining to a given factor are in the same color as the line that is fit 
             shape=20, #for a filled circle - 21 for open circles
             size=2,
             alpha=0.5)+
  scale_fill_manual(values=col.palette, name="Area")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="Area")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Gamma Diversity (log)")+
  ylab("Temporal Stability (log)")+
  ggtitle("Temporal Stability ~ Gamma Diversity*Area")+
  theme_bw()
plot.M7.lm2


#### 3. Gamma Stability ~ Gamma Diversity*Alpha Diversity ##############################################################################################

#### log transform!

my_data$log.gammadiv <- log(my_data$Gamma_div+1)
my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.div <- log(my_data$div+1)
my_data$log.div.factor <- as.factor(my_data$log.div)

M7.lm3 <- lm(log.gamma~log.gammadiv*log.div.factor, data=my_data)
M7.lm3
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M7.lm3)  #plot the diagnostic plots of lm10.anova for visual inspection of linearity, normality, homoscedasticity and outliers               
anova(M7.lm3)      
summary(M7.lm3)
confint(M7.lm3)

#plot 
par(mfrow=c(1,1))
levels(my_data$log.div.factor) <- c("ln(1)","ln(4)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(3) #change color palette 
plot.M7.lm3<-ggplot(data=my_data, aes(y=log.gamma, x=log.gammadiv))+
  geom_smooth(method=lm,  aes(col=log.div.factor))+
  geom_point(shape=21, 
             size=1,
             alpha=0.75, 
             fill="black")+
  scale_fill_manual(values=col.palette, name="div")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="div")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Gamma Diversity (log)")+
  ylab("Temporal Stability (log)")+
  ggtitle("Temporal Stability ~ Gamma Diversity*Alpha Diversity")+
  theme_bw()
plot.M7.lm3



#### 4. Gamma Stability ~ Gamma Diversity*Area*Alpha Diversity #########################################################################################

#### log transform!

my_data$log.gamma <- log(my_data$Gamma_stab+1)
my_data$log.gammadiv <- log(my_data$Gamma_div+1)
my_data$log.div <- log(my_data$div+1)
my_data$log.div.factor <- as.factor(my_data$log.div)
my_data$log.area <- log(my_data$Area+1)
my_data$log.area.factor <- as.factor(my_data$log.area)

M7.lm4 <- lm(log.gamma~log.gammadiv*log.area.factor*log.div.factor, data=my_data)
M7.lm4
par(mfrow=c(2,2)) #to create a 2x2 panel for the 4 diagnostic plots
plot(M7.lm4)  #plot the diagnostic plots of M7.lm4 for visual inspection of linearity, normality, homoscedasticity and outliers
anova(M7.lm4)      
summary(M7.lm4)
confint(M7.lm4)
        
#plot 
par(mfrow=c(1,1))
levels(my_data$log.area.factor) <- c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels of the categorical variable first
levels(my_data$log.div.factor) <- c("ln(1)","ln(4)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(8) #change color palette 
plot.M7.lm4<-ggplot(data=my_data, aes(y=log.gamma, x=log.gammadiv))+
  geom_smooth(method=lm,  aes(col=log.area.factor))+ #makes sure that for every level, the line that is fit has a different color
  geom_point(aes(col=log.area.factor), #makes sure that the colors pertaining to a given factor are in the same color as the line that is fit 
             shape=20, #for a filled circle - 21 for open circles
             size=2,
             alpha=0.5)+
  scale_fill_manual(values=col.palette, name="Area")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="Area")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Gamma Diversity (log)")+
  ylab(" Gamma Stability (log)")+
  ggtitle("Gamma Stability ~ Gamma Diversity*Area*Alpha Diversity")+
  facet_grid(~log.div.factor)+
  theme_bw()
plot.M7.lm4



#plot2
par(mfrow=c(1,1))
levels(my_data$log.area.factor) <- c("ln(1)","ln(2)","ln(3)","ln(4)","ln(5)","ln(6)","ln(7)","ln(8)") #renaming the levels of the categorical variable first
levels(my_data$log.div.factor) <- c("ln(1)","ln(4)","ln(8)") #renaming the levels of the categorical variable first
col.palette<-viridis(3) #change color palette 
plot.M7.lm4<-ggplot(data=my_data, aes(y=log.gamma, x=log.gammadiv))+
  geom_smooth(method=lm,  aes(col=log.div.factor))+ #makes sure that for every level, the line that is fit has a different color
  geom_point(aes(col=log.div.factor), #makes sure that the colors pertaining to a given factor are in the same color as the line that is fit 
             shape=20, #for a filled circle - 21 for open circles
             size=2,
             alpha=0.5)+ #for point transparency - between 0 and 1
  scale_fill_manual(values=col.palette, name="Alpha Diversity")+  #values = setting the color used for each level; name = Legend Name
  scale_color_manual(values=col.palette, name="Alpha Diversity")+ #specifying the same color palette and label for fill and color so that they appear in the same legend
  xlab("Gamma Diversity (log)")+
  ylab(" Gamma Stability (log)")+
  ggtitle("Gamma Stability ~ Gamma Diversity*Area*Alpha Diversity")+
  facet_grid(~log.area.factor)+
  theme_bw()
plot.M7.lm4

#### Compare models ####################################################################################################################################

anova(M7.lm1, M7.lm2, M7.lm3, M7.lm4)
# M7.lm2 significantly improved the fit compared to the other ones

```

```{r end}

sessionInfo()

```
